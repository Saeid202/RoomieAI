# Canadian PAD Payment Architecture

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ROOMIE AI PLATFORM                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   TENANT SIDE    â”‚                           â”‚  LANDLORD SIDE   â”‚   â”‚
â”‚  â”‚                  â”‚                           â”‚                  â”‚   â”‚
â”‚  â”‚  1. Select       â”‚                           â”‚  1. Onboard to   â”‚   â”‚
â”‚  â”‚     Payment      â”‚                           â”‚     Stripe       â”‚   â”‚
â”‚  â”‚     Method       â”‚                           â”‚     Connect      â”‚   â”‚
â”‚  â”‚                  â”‚                           â”‚                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                           â”‚  2. Link Bank    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ’³ Card    â”‚  â”‚                           â”‚     Account      â”‚   â”‚
â”‚  â”‚  â”‚ Fee: 2.9%  â”‚  â”‚                           â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ Instant    â”‚  â”‚                           â”‚  3. Receive      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                           â”‚     Payouts      â”‚   â”‚
â”‚  â”‚                  â”‚                           â”‚                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚  â”‚ ğŸ¦ PAD     â”‚  â”‚                                    â–²              â”‚
â”‚  â”‚  â”‚ Fee: 1%    â”‚  â”‚                                    â”‚              â”‚
â”‚  â”‚  â”‚ 3-5 days   â”‚  â”‚                                    â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                    â”‚              â”‚
â”‚  â”‚                  â”‚                                    â”‚              â”‚
â”‚  â”‚  2. Authorize    â”‚                                    â”‚              â”‚
â”‚  â”‚     Payment      â”‚                                    â”‚              â”‚
â”‚  â”‚                  â”‚                                    â”‚              â”‚
â”‚  â”‚  3. Confirm      â”‚                                    â”‚              â”‚
â”‚  â”‚     & Pay        â”‚                                    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚              â”‚
â”‚           â”‚                                              â”‚              â”‚
â”‚           â–¼                                              â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚              â”‚
â”‚  â”‚         SUPABASE EDGE FUNCTIONS                     â”‚â”‚              â”‚
â”‚  â”‚                                                      â”‚â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚              â”‚
â”‚  â”‚  â”‚  execute-payment                             â”‚  â”‚â”‚              â”‚
â”‚  â”‚  â”‚  - Detect payment type                       â”‚  â”‚â”‚              â”‚
â”‚  â”‚  â”‚  - Route to appropriate handler              â”‚  â”‚â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚              â”‚
â”‚  â”‚           â”‚                                         â”‚â”‚              â”‚
â”‚  â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚              â”‚
â”‚  â”‚           â–¼             â–¼                          â”‚â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚              â”‚
â”‚  â”‚  â”‚ Card Payment â”‚  â”‚  PAD Payment             â”‚  â”‚â”‚              â”‚
â”‚  â”‚  â”‚              â”‚  â”‚  (ACSS Debit)            â”‚  â”‚â”‚              â”‚
â”‚  â”‚  â”‚ - Instant    â”‚  â”‚  - Create PaymentIntent  â”‚  â”‚â”‚              â”‚
â”‚  â”‚  â”‚ - 2.9% fee   â”‚  â”‚  - Pass acss_debit opts  â”‚  â”‚â”‚              â”‚
â”‚  â”‚  â”‚              â”‚  â”‚  - Mandate handling      â”‚  â”‚â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - 1% fee                â”‚  â”‚â”‚              â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚              â”‚
â”‚                              â”‚                           â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–¼                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STRIPE PLATFORM                     â”‚              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
â”‚  â”‚  PAYMENT PROCESSING                                â”‚ â”‚              â”‚
â”‚  â”‚                                                     â”‚ â”‚              â”‚
â”‚  â”‚  Card Payment:                                     â”‚ â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚              â”‚
â”‚  â”‚  â”‚ 1. Charge card immediately                   â”‚ â”‚ â”‚              â”‚
â”‚  â”‚  â”‚ 2. Funds available in 1-2 days              â”‚ â”‚ â”‚              â”‚
â”‚  â”‚  â”‚ 3. Transfer to Connect account              â”‚ â”‚ â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚              â”‚
â”‚  â”‚                                                     â”‚ â”‚              â”‚
â”‚  â”‚  PAD Payment (ACSS Debit):                        â”‚ â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚              â”‚
â”‚  â”‚  â”‚ 1. Initiate bank debit                      â”‚ â”‚ â”‚              â”‚
â”‚  â”‚  â”‚ 2. Wait 3-5 days for clearing               â”‚ â”‚ â”‚              â”‚
â”‚  â”‚  â”‚ 3. Verify mandate compliance                â”‚ â”‚ â”‚              â”‚
â”‚  â”‚  â”‚ 4. Transfer to Connect account              â”‚ â”‚ â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
â”‚                                                          â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
â”‚  â”‚  STRIPE CONNECT (Landlord Accounts)               â”‚ â”‚              â”‚
â”‚  â”‚                                                     â”‚ â”‚              â”‚
â”‚  â”‚  - Express Account per landlord                   â”‚ â”‚              â”‚
â”‚  â”‚  - Automatic payouts to bank                      â”‚ â”‚              â”‚
â”‚  â”‚  - Balance tracking                               â”‚ â”‚              â”‚
â”‚  â”‚  - Compliance/KYC handling                        â”‚ â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
â”‚                              â”‚                           â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–¼                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Tenant's Bank   â”‚      â”‚ Landlord's Bank  â”‚
                    â”‚                  â”‚      â”‚                  â”‚
                    â”‚  Funds debited   â”‚      â”‚  Funds credited  â”‚
                    â”‚  (3-5 days)      â”‚      â”‚  (2-3 days after â”‚
                    â”‚                  â”‚      â”‚   clearing)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Payment Flow Sequence Diagrams

### Card Payment Flow

```
Tenant          Roomie AI         Stripe          Landlord
  â”‚                 â”‚                â”‚                â”‚
  â”‚ Select Card     â”‚                â”‚                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚
  â”‚ Confirm $2058   â”‚                â”‚                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚
  â”‚                 â”‚ Create PI      â”‚                â”‚
  â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚
  â”‚                 â”‚ Charge Card    â”‚                â”‚
  â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚
  â”‚                 â”‚ Success âœ“      â”‚                â”‚
  â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
  â”‚                 â”‚                â”‚                â”‚
  â”‚ Payment Success â”‚                â”‚                â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚
  â”‚                 â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚ Transfer       â”‚
  â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                 â”‚                â”‚                â”‚
  â”‚                 â”‚                â”‚ Payout (2-3d)  â”‚
  â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                 â”‚                â”‚                â”‚
```

### PAD Payment Flow

```
Tenant          Roomie AI         Stripe          Tenant Bank    Landlord
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚ Select PAD      â”‚                â”‚                â”‚              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚              â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚ Authorize       â”‚                â”‚                â”‚              â”‚
  â”‚ Mandate         â”‚                â”‚                â”‚              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚              â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚                 â”‚ Create Mandate â”‚                â”‚              â”‚
  â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚              â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚ Confirm $2020   â”‚                â”‚                â”‚              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚              â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚                 â”‚ Create PI      â”‚                â”‚              â”‚
  â”‚                 â”‚ + acss_debit   â”‚                â”‚              â”‚
  â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚              â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚ Processing...   â”‚                â”‚ Initiate Debit â”‚              â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚                 â”‚                â”‚ [Wait 3-5 days]â”‚              â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚                 â”‚                â”‚ Debit Account  â”‚              â”‚
  â”‚                 â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚                 â”‚ Payment Clear  â”‚                â”‚              â”‚
  â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚              â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚ Payment Success â”‚                â”‚                â”‚              â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚              â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚                 â”‚                â”‚ Transfer       â”‚              â”‚
  â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
  â”‚                 â”‚                â”‚ Payout (2-3d)  â”‚              â”‚
  â”‚                 â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                 â”‚                â”‚                â”‚              â”‚
```

---

## Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE DATABASE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  payment_methods                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ id, user_id, payment_type, stripe_payment_method_id   â”‚    â”‚
â”‚  â”‚ mandate_id, mandate_status, bank_name, last4          â”‚    â”‚
â”‚  â”‚ card_type, brand, is_default                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚  rent_payments                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ id, tenant_id, landlord_id, property_id               â”‚    â”‚
â”‚  â”‚ amount, transaction_fee, payment_method_type          â”‚    â”‚
â”‚  â”‚ status, payment_cleared_at, expected_clear_date       â”‚    â”‚
â”‚  â”‚ stripe_payment_intent_id, stripe_mandate_id           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚  payment_accounts (Stripe Connect)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ id, user_id, account_type, stripe_account_id          â”‚    â”‚
â”‚  â”‚ available_balance, pending_balance, total_paid_out    â”‚    â”‚
â”‚  â”‚ stripe_account_status, stripe_onboarding_completed    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Fee Structure Breakdown

### Platform Revenue Model

```
Card Payment ($2,000 rent):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tenant Pays:        $2,058.30          â”‚
â”‚                                         â”‚
â”‚ Breakdown:                              â”‚
â”‚ - Rent:             $2,000.00          â”‚
â”‚ - Platform Fee:        $58.30 (2.9%)   â”‚
â”‚                                         â”‚
â”‚ Stripe Charges:        $58.30          â”‚
â”‚ Platform Keeps:         $0.00          â”‚
â”‚ Landlord Receives:  $2,000.00          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PAD Payment ($2,000 rent):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tenant Pays:        $2,020.25          â”‚
â”‚                                         â”‚
â”‚ Breakdown:                              â”‚
â”‚ - Rent:             $2,000.00          â”‚
â”‚ - Platform Fee:        $20.25 (1%)     â”‚
â”‚                                         â”‚
â”‚ Stripe Charges:         $5.00 (0.25%)  â”‚
â”‚ Platform Keeps:        $15.25          â”‚
â”‚ Landlord Receives:  $2,000.00          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tenant Savings with PAD: $38.05/month
Platform Revenue with PAD: $15.25/transaction
```

---

## Critical Stripe API Parameters

### PaymentIntent for Card

```json
{
  "amount": 205830,
  "currency": "cad",
  "payment_method_types": ["card"],
  "payment_method": "pm_card_visa",
  "customer": "cus_xxxxx",
  "transfer_data": {
    "destination": "acct_landlord_xxxxx"
  }
}
```

### PaymentIntent for PAD (CRITICAL)

```json
{
  "amount": 202025,
  "currency": "cad",
  "payment_method_types": ["acss_debit"],
  "payment_method": "pm_acss_debit_xxxxx",
  "customer": "cus_xxxxx",
  "payment_method_options": {
    "acss_debit": {
      "mandate_options": {
        "payment_schedule": "interval",
        "interval_description": "Monthly rent payment",
        "transaction_type": "personal"
      },
      "verification_method": "instant"
    }
  },
  "transfer_data": {
    "destination": "acct_landlord_xxxxx"
  }
}
```

**KEY**: The `payment_method_options.acss_debit` parameter is REQUIRED for Canadian PAD to work properly.

---

## Timeline Comparison

### Card Payment Timeline
```
Day 0: Payment initiated â”€â”€> Instant success
Day 1-2: Funds available in Stripe
Day 2-3: Transfer to landlord Connect account
Day 4-5: Landlord receives payout

Total: 4-5 days to landlord's bank
```

### PAD Payment Timeline
```
Day 0: Payment initiated â”€â”€> Processing status
Day 1-3: Bank processing
Day 3-5: Payment clears â”€â”€> Success status
Day 6-8: Transfer to landlord Connect account
Day 8-10: Landlord receives payout

Total: 8-10 days to landlord's bank
```

---

## User Experience Comparison

### Card Payment UX
âœ… Instant confirmation  
âœ… Immediate receipt  
âœ… No waiting period  
âŒ Higher fees ($58 vs $20)  
âŒ Not ideal for recurring payments  

### PAD Payment UX
âœ… Lowest fees (save $38/month)  
âœ… Perfect for recurring rent  
âœ… Automatic monthly debits  
âœ… No card expiry issues  
âŒ 3-5 day processing time  
âŒ Requires mandate authorization  
âŒ NSF risk if insufficient funds  

---

## Security & Compliance

### PAD Mandate Requirements (Canadian Law)
1. âœ… Clear authorization language
2. âœ… Payor and payee identification
3. âœ… Payment amount and frequency
4. âœ… Cancellation rights disclosure
5. âœ… Electronic signature capture
6. âœ… Mandate storage (Stripe handles)
7. âœ… Dispute resolution process

### Stripe Compliance Features
- Automatic mandate collection
- Secure bank account tokenization
- PCI-DSS Level 1 certification
- Canadian banking regulations compliance
- Fraud detection and prevention

---

**Architecture Document Created**: February 19, 2026  
**System**: Canadian PAD Payment Integration  
**Status**: Planning Phase
